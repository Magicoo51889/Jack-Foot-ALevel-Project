# 2.2.2 Cycle 2

## Design

### Objectives

In this cycle I aim to improve the movement of the player before I go on to add maps and enemies, as this is a core mechanic of the game, and can make or break a game. At the moment the player physics are a bit clunky, and unnatural, so I want to make it a bit smoother and realistic. Doing this will probably involve altering the control.js file to be able to change how the rotation works, and using a forward movement based off of the angle the ship is facing.&#x20;

Additionally the player doesn't hit a map boundary and stop. The player can move off of the map, and this is immersion breaking and doesn't look good. I want to make these boundaries around the edge of the map so that the player can't move into the background.

* [x] Realistic floating physics
* [x] Player doesn't centre back to 90 degrees immediately after stopping.&#x20;
* [x] Add map boundaries.&#x20;

### Usability Features

### Key Variables

| Variable Name         | Use                                                                                                      |
| --------------------- | -------------------------------------------------------------------------------------------------------- |
| forceMagnitude        | This is the variable that I use to be able to easily change the speed of the player when moving forwards |
| angularForceMagnitude | This is variable for the speed at which the player rotates.                                              |

### Pseudocode

```
procedure controls
    force = 0.1
    angularForce = 0.05
    
    if keys.W or cursors.up is pressed
        velocityX = force
  
    if keys.A or cursors.left is pressed
        velocityY = -angularForce
    else if keys.D or cursors.right is pressed
        velocityY  = angularForce
    
end procedure
```

## Development

### Outcome

From this I was able to create the code that allowed my player to move more fluidly and predictably, whilst being natural to use, and remaining similar to movement in a low gravity environment.&#x20;

{% tabs %}
{% tab title="screenWrap.ts" %}
{% code title="screenWrap.ts" %}
```typescript
export default function screenWrap (player) {
    console.log("Calling screenwrap")    if (player.x < 0)
    {
        player.x = this.width;
    }
    else if (player.x > this.width)
    {
        player.x = 0;
    }    if (player.y < 0)
    {
        player.y = this.height;
    }
    else if (player.y > this.height)
    {
        player.y = 0;
    }
}
```
{% endcode %}
{% endtab %}

{% tab title="controls.ts" %}
{% code title="controls.ts" %}
```typescript
import { cursors } from "../../scenes/PlayScene";

export default function createCursorKeys(keys, player){
  let forceMagnitude = 0.001;
  let angularForceMagnitude = 0.05;

  if (keys.W.isDown || cursors.up.isDown){
    console.log(player)
    player.applyForce(forceMagnitude);

  }

  if (keys.A.isDown || cursors.left.isDown){
    player.setAngularVelocity(-angularForceMagnitude);
  } else if (keys.D.isDown || cursors.right.isDown){
    player.setAngularVelocity(angularForceMagnitude);
  }
}

```
{% endcode %}
{% endtab %}
{% endtabs %}

### Challenges

What I found most challenging was getting Phaser's built in functions to work, as many of them weren't as simple as just doing **`player.setVelocity()`** and I found this quite difficult to find a solution to, as all the documentation for Phaser is quite lacking or outdated (made for Phaser 2.0 not 3.0 like what I'm using). Once I found what worked (which usually involved having to make my some big changes to the code elsewhere) I was quickly able to find a good movement speed.&#x20;

* Getting Phaser to recognise the different functions

## Testing

Evidence for testing

### Tests

| Test | Instructions                  | What I expect                                        | What actually happens                                                                                     | Pass/Fail |
| ---- | ----------------------------- | ---------------------------------------------------- | --------------------------------------------------------------------------------------------------------- | --------- |
| 1    | Press the arrow keys or WASD. | The character to move accordingly based on each key. | Rotation works but as soon as you try and move the game crashes.                                          | Fail      |
| 2    | Press the arrow keys or WASD. | The character to move accordingly based on each key. | Nothing.                                                                                                  | Fail      |
| 3    | Press the arrow keys or WASD. | The character to move accordingly based on each key. | The rotation works, but the player vanishes beyond the play area. X = Nan, Y = Nan. Didn't crash though.  | Fail      |
| 4    |                               |                                                      |                                                                                                           |           |

### Evidence
